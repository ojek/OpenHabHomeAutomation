import org.openhab.model.script.actions.Timer
var Timer motionTimer = null
var Timer buttonTimer = null
val int motionTimeout = 5
val int buttonTimeout = 30

rule "Light1"
when
    Item MotionSensor_Bedroom_Main received update or
    Item MotionSensor_LivingRoom_Main received update
then
    if (buttonTimer == null && (MotionSensor_Bedroom_Main.state == 1 || MotionSensor_LivingRoom_Main.state == 1))
    {
        if (motionTimer !== null)
        {
            motionTimer.reschedule(now.plusSeconds(motionTimeout))
        }
        else 
        {
            if (Yeelight1_switch.state == OFF)
            {
                Yeelight1_switch.sendCommand("ON")
                motionTimer = createTimer(now.plusSeconds(motionTimeout)) [|
                    Yeelight1_switch.sendCommand("OFF")
                    motionTimer.cancel
                    motionTimer = null
                ]
            }
        }
    }
end

rule "Light2"
when
    Item Sonoff_T1_LivingRoom_Main_SW1 received update
then
    if (motionTimer !== null)
    {
        motionTimer.cancel
        motionTimer = null
    }

    if (buttonTimer !== null)
    {
        buttonTimer.reschedule(now.plusSeconds(buttonTimeout))
    }
    else
    {    
        if (Sonoff_T1_LivingRoom_Main_SW1.state == ON)
        {
            Yeelight1_switch.sendCommand("ON")
            buttonTimer = createTimer(now.plusSeconds(buttonTimeout)) [|
                Yeelight1_switch.sendCommand("OFF")
                Sonoff_T1_LivingRoom_Main_SW1.sendCommand("OFF")
                buttonTimer.cancel
                buttonTimer = null
            ]
        }
        else
        {
            Yeelight1_switch.sendCommand("OFF")
        }
    }
end

//rule "Light3"
//when
//    Item Yeelight1_switch_proxy received update
//then
//    if ()
//    {
//        if (Yeelight1_switch_proxy.state == ON)
//        {
//            if (Yeelight1_switch.state == OFF)
//            {
//                Yeelight1_switch.sendCommand("ON")
//            }
//        }
//        else if (Yeelight1_switch_proxy.state == OFF)
//        {
//            if (Yeelight1_switch.state == ON)
//            {
//                Yeelight1_switch.sendCommand("OFF")
//            }
//        }
//    }
//end